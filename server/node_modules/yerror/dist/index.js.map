{"version":3,"sources":["../src/index.js"],"names":["YError","wrappedErrors","errorCode","params","Array","concat","code","name","toString","Error","captureStackTrace","constructor","length","stack","os","EOL","join","wrap","yerrorWrap","err","yError","wrappedErrorIsACode","_looksLikeAYErrorCode","message","push","cast","yerrorCast","_looksLikeAYError","apply","bump","yerrorBump","endsWith","str","test"],"mappings":"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","sourcesContent":["import os from 'os';\n\n/**\n * An YError class able to contain some params and\n *  print better stack traces\n * @extends Error\n */\nclass YError extends Error {\n  /**\n   * Creates a new YError with an error code\n   *  and some params as debug values.\n   * @param {string} [errorCode = 'E_UNEXPECTED']\n   * The error code corresponding to the actual error\n   * @param {...any} [params]\n   * Some additional debugging values\n   */\n  constructor(wrappedErrors, errorCode, ...params) {\n    // Detecting if wrappedErrors are passed\n    if (!(wrappedErrors instanceof Array)) {\n      params = ('undefined' === typeof errorCode ? [] : [errorCode]).concat(\n        params,\n      );\n      errorCode = wrappedErrors;\n      wrappedErrors = [];\n    }\n\n    // Call the parent constructor\n    super(errorCode);\n\n    // Filling error\n    this.code = errorCode || 'E_UNEXPECTED';\n    this.params = params;\n    this.wrappedErrors = wrappedErrors;\n    this.name = this.toString();\n\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor);\n    }\n  }\n\n  toString() {\n    return (\n      (this.wrappedErrors.length\n        ? // eslint-disable-next-line\n          this.wrappedErrors[this.wrappedErrors.length - 1].stack + os.EOL\n        : '') +\n      this.constructor.name +\n      ': ' +\n      this.code +\n      ' (' +\n      this.params.join(', ') +\n      ')'\n    );\n  }\n}\n\n/**\n * Wraps any error and output a YError with an error\n *  code and some params as debug values.\n * @param {Error} err\n * The error to wrap\n * @param {string} [errorCode = 'E_UNEXPECTED']\n * The error code corresponding to the actual error\n * @param {...any} [params]\n * Some additional debugging values\n * @return {YError}\n * The wrapped error\n */\nYError.wrap = function yerrorWrap(err, errorCode, ...params) {\n  let yError = null;\n  const wrappedErrorIsACode = _looksLikeAYErrorCode(err.message);\n  const wrappedErrors = (err.wrappedErrors || []).concat(err);\n\n  if (!errorCode) {\n    if (wrappedErrorIsACode) {\n      errorCode = err.message;\n    } else {\n      errorCode = 'E_UNEXPECTED';\n    }\n  }\n  if (err.message && !wrappedErrorIsACode) {\n    params.push(err.message);\n  }\n  yError = new YError(wrappedErrors, errorCode, ...params);\n  return yError;\n};\n\n/**\n * Return a YError as is or wraps any other error and output\n *  a YError with a code and some params as debug values.\n * @param {Error} err\n * The error to cast\n * @param {string} [errorCode = 'E_UNEXPECTED']\n * The error code corresponding to the actual error\n * @param {...any} [params]\n * Some additional debugging values\n * @return {YError}\n * The wrapped error\n */\nYError.cast = function yerrorCast(err, ...params) {\n  if (_looksLikeAYError(err)) {\n    return err;\n  }\n  return YError.wrap.apply(YError, [err].concat(params));\n};\n\n/**\n * Same than `YError.wrap()` but preserves the code\n *  and the debug values of the error if it is\n *  already an instance of the YError constructor.\n * @param {Error} err\n * The error to bump\n * @param {string} [errorCode = 'E_UNEXPECTED']\n * The error code corresponding to the actual error\n * @param {...any} [params]\n * Some additional debugging values\n * @return {YError}\n * The wrapped error\n */\nYError.bump = function yerrorBump(err, ...params) {\n  if (_looksLikeAYError(err)) {\n    return YError.wrap.apply(YError, [err, err.code].concat(err.params));\n  }\n  return YError.wrap.apply(YError, [err].concat(params));\n};\n\n// In order to keep compatibility through major versions\n// we have to make kind of an cross major version instanceof\nfunction _looksLikeAYError(err) {\n  return (\n    err instanceof YError ||\n    (err.constructor &&\n      err.constructor.name &&\n      err.constructor.name.endsWith('Error') &&\n      'string' === typeof err.code &&\n      _looksLikeAYErrorCode(err.code) &&\n      err.params &&\n      err.params instanceof Array)\n  );\n}\n\nfunction _looksLikeAYErrorCode(str) {\n  return /^([A-Z0-9_]+)$/.test(str);\n}\n\nexport default YError;\n"],"file":"index.js"}